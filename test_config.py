import asyncio
import requests
import time

# =====================
# –§—É–Ω–∫—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤ (USD –∏ EUR)
# =====================
def get_current_usd_rate():
    """–ü–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å USD –∫ MDL —á–µ—Ä–µ–∑ API"""
    try:
        url = "https://api.exchangerate-api.com/v4/latest/USD"
        response = requests.get(url, timeout=5)
        data = response.json()
        rate = data['rates']['MDL']
        print(f"‚úÖ –ö—É—Ä—Å USD –æ–±–Ω–æ–≤–ª–µ–Ω: {rate} MDL")
        return float(rate)
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ USD ({e}). –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç: 18.2")
        return 18.2

def get_current_eur_rate():
    """–ü–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å EUR –∫ MDL —á–µ—Ä–µ–∑ API"""
    try:
        url = "https://api.exchangerate-api.com/v4/latest/EUR"
        response = requests.get(url, timeout=5)
        data = response.json()
        rate = data['rates']['MDL']
        print(f"‚úÖ –ö—É—Ä—Å EUR –æ–±–Ω–æ–≤–ª–µ–Ω: {rate} MDL")
        return float(rate)
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ EUR ({e}). –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç: 19.8")
        return 19.8

# =====================
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞
# =====================
BOT_TOKEN = "8175077901:AAFIgOsDIdSiwkNoblyMDGAH5zF5uWBWUSo"
ALLOWED_CHAT_ID = -1003572783517

# =====================
# –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–ê–Ω–∞–ª–∏—Ç–∏–∫–∞)
# =====================
USD_TO_MDL = get_current_usd_rate()
EUR_TO_MDL = get_current_eur_rate()

# –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (3 –Ω–µ–¥–µ–ª–∏ = 504 —á–∞—Å–∞)
# –û–±—ä—è–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—à–µ —ç—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –±—É–¥—É—Ç —É–¥–∞–ª—è—Ç—å—Å—è –∏–∑ –∞–Ω–∞–ª–∏–∑–∞
MAX_AGE_HOURS = 504

MIN_PROFIT_USD = 25      # –£–≤–µ–¥–æ–º–ª—è—Ç—å, –µ—Å–ª–∏ –æ–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–∏–±—ã–ª—å –æ—Ç 25$
RESELL_DISCOUNT = 0.93   # –°–∫–∏–¥–∫–∞ –æ—Ç —Ä—ã–Ω–∫–∞ (7%) –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–¥–∞–∂–∏
MIN_ADS_FOR_STATS = 10   # –ú–∏–Ω–∏–º—É–º –æ–±—ä—è–≤–ª–µ–Ω–∏–π –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –º–µ–¥–∏–∞–Ω—ã

# =====================
# –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
# =====================
PAGE_SIZE = 4
CATEGORY_NAMES = {
    "new": "üÜï –í—ã–≥–æ–¥–Ω—ã–µ",
    "in_work": "üõ† –í —Ä–∞–±–æ—Ç–µ",
    "bought": "‚úÖ –ö—É–ø–ª–µ–Ω–æ",
    "trash": "üóë –ú—É—Å–æ—Ä"
}

# =====================
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫–∞–Ω–µ—Ä–∞ (999.md)
# =====================
URL = "https://999.md/ru/list/phone-and-communication/mobile-phones?appl=1&ef=1078,9013,6,16,2200&eo=6309&o_1078_590_6309=23687,23688,23689,24467,24469,24470,26276,26277,26278,26279,32674,32673,32675,32676,39233,39236,39234,39235,42336,43527,43529,43530&sort_type=date_desc"

MAX_ADS = 15           # –°–∫–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∑–∞ –æ–¥–∏–Ω –∫—Ä—É–≥
SCROLL_PAUSE = 3
AD_PAGE_WAIT = 2       # –°–∫–æ–ª—å–∫–æ –∂–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±—ä—è–≤–ª–µ–Ω–∏—è
PAGE_LOAD_WAIT = 5

# –§–∏–ª—å—Ç—Ä –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (STOP_WORDS)
STOP_WORDS = [
    "–∫—É–ø–ª—é", "cumpar", "cumpƒÉr", "–∫—É–ø–∏–º", "–≤—ã–∫—É–ø", "skupka",
    "—Å–∫—É–ø–∫–∞", "–æ–±–º–µ–Ω", "schimb", "chirie", "–∞—Ä–µ–Ω–¥–∞", "–∏—â—É", "caut",
    "piese", "–∑–∞–ø—á–∞—Å—Ç–∏", "—Ä–∞–∑–±–æ—Ä–∫–∞", "–¥–µ—Ç–∞–ª–∏", "—ç–∫—Ä–∞–Ω", "–¥–∏—Å–ø–ª–µ–π",
    "service", "reparatie", "–±–∏—Ç—ã–π", "cracked", "not working", "defect",
    "icloud", "id –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω", "mdm", "r-sim", "rsim", "bypass", "locked",
    "garantie", "garan»õie", "–≥–∞—Ä–∞–Ω—Ç–∏—è", "credit", "–∫—Ä–µ–¥–∏—Ç", "rata", "rate",
    "magazin", "–º–∞–≥–∞–∑–∏–Ω", "smarti", "darwin", "enter", "liberty", "0%",
    "livrare", "–¥–æ—Å—Ç–∞–≤–∫–∞", "–Ω–∞–ª–∏—á–∏–∏", "stoc"
    # –°–ª–æ–≤–æ "nou" –∏ "–Ω–æ–≤—ã–π" —É–±—Ä–∞–ª, —Ç–∞–∫ –∫–∞–∫ iPhone 17 —á–∞—Å—Ç–æ –ø–æ–º–µ—á–∞—é—Ç –∫–∞–∫ –Ω–æ–≤—ã–µ
]

# =====================
# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
# =====================
ads_data = []
scanning_lock = asyncio.Lock()